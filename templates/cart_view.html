{% extends 'index.html' %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load custemtemplates %}

{% block navlinks %}
            {% if user.is_authenticated %}
                        <form class="form-inline ml-auto mr-5" method="GET">
                        <input class="form-control mr-sm-2" type="search" style="width: 285px;height: 35px;" name="q" value="{{ request.GET.q }}" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success btn-sm" style="width: 85px;height: 30px;" type="submit">Search</button>
                        </form>
                        <ul class="navbar-nav " style="margin-right: 8%;">
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" style="width: 80px; color: black;" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fas fa-users-cog fa-lg" style="margin-right: 10px;"></i><strong >{{user.first_name}}</strong>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-left " aria-labelledby="navbarDropdownMenuLink">
                                        <strong> 
                                            <a class="dropdown-item" href="{% url 'homepage'%}"  >Product list Page</a> 
                                            <a class="dropdown-item" onclick="conformation()" >Logout</a>
                                        </strong>
                                    </div>
                                </li>
                        </ul>
            {% endif %}
{% endblock %}

{% block container_block %}

 <style>
  .card-content{
      width: 95%;
      margin: 0px;
      margin: auto;
      padding-bottom:20px ;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.897);
      cursor: pointer;
      border: 3px solid white;
      border-radius: 3%;
      box-shadow: 0 15px 15px 0 rgba(148, 185, 202, 0.747), 0 20px 20px 0 rgba(148, 185, 202, 0.747);
  }
  .card-content:hover{
        background-color: white ;
        box-shadow: 0 4px 8px 0 rgba(109, 50, 50, 0.671), 0 6px 20px 0 rgba(131, 75, 75, 0.644);
        transform: scale(1.05);
  }
  .card-content > img{
        display: block;
        margin: auto; 
        height: 175px; 
        width: 175px;
}

  body{
      scrollbar-width: thin;
      background-image: url("{% static 'logo.png'%}");
      background-position: center;
      background-attachment:fixed ;
      background-repeat:no-repeat ;
      background-position-y: 50px;
  }
.row{
    margin-bottom: 5%;
}
.btn{
        width: 160px;
        height: 35px;
}
.columns{
        display: none;
        width: 80%;
}
#lefttext{
        text-align: left;
        background-color:white;
        border-radius: 10%;
        height: 37px;
        line-height:37px ;
}
#righttext{
        text-align: left;
        background-color:white; 
        border-radius: 10%;
        height: 37px;
        line-height:37px;
}

.price{
        text-align: left;margin:10px 
}
.description{
        height: 50px;width: 95%;overflow: auto;margin: auto;text-align: left;margin-bottom: 5%;
}
#top-container{
        padding: 0;margin: 0;
        width:100%;
        margin:auto;
        margin-top: 2%;
}
#catogorylist{
        list-style: none;
        padding: 0;
        margin: 0;
       
}
#catogorylist > li{
        border: 2px solid rgb(127, 178, 212);
        text-align: center;
        padding: 2%;
        margin-top: 10px;
        border-radius: 15px;
        cursor: pointer;
        color: black;
}
#catogorylist > li:hover{
        background-color: rgb(127, 178, 212) !important;
        box-shadow: 0 4px 8px 0 rgba(0,0,0,.2), 0 6px 20px 0 rgba(0,0,0,.19);
        transform: scale(1.1);
        color: white;
}
#postform{
    width: 70%;
    box-shadow: 0 4px 8px 0 rgb(127, 178, 212),0 6px 20px 0 rgb(127, 178, 212);
    background-color: rgba(245, 245, 245, 0.795);
    padding: 3%;
    margin: auto;
    margin-bottom: 3%;
}
 </style>
<h1 style="height: 30px;line-height: 30px;"><span class="ml-5" style="font-family: 'Yeon Sung', cursive;">Inventory</span></h1>
  <div class="row">
            <div class="col-sm-2" style=" border-right: 2px solid rgb(127, 178, 212);">
                    <h4 style="text-align: center; margin-top:25px;text-decoration: underline;">OPTIONS</h4>
                    <ul id="catogorylist">
                            <li id='opt1' onclick="options(this)">Cart</li>
                            <li id='opt2' onclick="options(this)">Posted-Product</li>
                            <li id='opt3' onclick="options(this)">Requested-Product</li>
                            <li id='opt4' onclick="options(this)">Post</li>
                    </ul>
            </div>
         <div class="col-sm-10">
                    <div class="container-fluid mb-5" id="top-container" >
                                <div class="pagination mb-4" style="color: black; width:150px; margin: auto;text-align: center;background-color: white;">
                                                <span class="step-links">                                     
                                                    <span class="current btn  btn-outline-dark btn-sm" style="width:150px;height: 30px;">
                                                        Page {{ pagenumber.number }} of {{ pagenumber.paginator.num_pages }}.
                                                    </span>
                                                </span>
                                </div>
                        <div class="container-fluid" style="width: 95%;">

                            {% if option == 'Cart' %}

                                        {%for one,two in objects %}
                                        <div class="row">
                                                        <div  class="col-sm-6 columns" >
                                                            <div class="card-content"  ondblclick="detailvalue(this)" >
                                                                <h4 id="lefttext" ><span style="margin-left: 5px;">{{one.product_id.Productname}}</span></h4>
                                                                <img class="rounded" src="{{ one.product_id.product_mage.url }}" alt="Oh no image!" >
                                                                <h2 class="price" >Rs.{{one.product_id.price }}</h2>
                                                                <p class="description" >{{one.product_id.Description}}</p>
                                                                <p class='product_id'style="display:none">{{one.product_id.Id}}</p>
                                                                <p class='cart_id'style="display:none;">{{one.cart_id}}</p>
                                                                <button class="btn btn-sm btn-outline-danger" onmouseover="addcontent(this,'remove from Cart')" onmouseout="removecontent(this,'Cart')" onclick="deletecart(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                                <button class="btn btn-sm btn-outline-dark"  onmouseover="addcontent(this,'Buy')" onmouseout="removecontent(this,'Buy')"><i class="fas fa-money-check-alt fa-2x "></i></button>
                                                            </div>         
                                                        </div>
                                                {% if two %}
                                                        <div  class="col-sm-6 columns" >
                                                                <div class="card-content"  ondblclick="detailvalue(this)" >
                                                                    <h4 id="righttext" ><span style="margin-left: 5px;">{{ two.product_id.Productname}}</span></h4>
                                                                    <img class="rounded" src="{{ two.product_id.product_mage.url }}" alt="Oh no image!">
                                                                    <h2 class="price">Rs.{{two.product_id.price}}</h2>
                                                                    <p class="description" >{{two.product_id.Description}}</p>
                                                                    <p class='product_id'style="display:none;">{{two.product_id.Id}}</p>
                                                                    <p class='cart_id'style="display:none;">{{two.cart_id}}</p>
                                                                    <button class="btn btn-sm btn-danger" onmouseover="addcontent(this,'remove from Cart')" onmouseout="removecontent(this,'Cart')" onclick="deletecart(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                                    <button class="btn btn-sm btn-warning"  onmouseover="addcontent(this,'Buy')" onmouseout="removecontent(this,'Buy')"><i class="fas fa-money-check-alt fa-2x "></i></button>
                                                                </div>
                                                        </div>
                                                {% endif %}
                                        </div>
                                        {% empty %}
                                        <div class="conatiner" style="width:70%;margin: auto;">
                                                <img src="{% static 'empty.png'%}" alt="No product match">
                                        </div>
                                        {% endfor %}
                            {% elif option == 'Requested-Product' %}
                                        {%for one,two in objects %}
                                        <div class="row">
                                                        <div  class="col-sm-6 columns" >
                                                                <div class="card-content"  ondblclick="detailvalue(this)" >
                                                                <h4 id="lefttext" ><span style="margin-left: 5px;">{{one.product_id.Productname}}</span></h4>
                                                                <img class="rounded" src="{{ one.product_id.product_mage.url }}" alt="Oh no image!" >
                                                                <h2 class="price" >Rs.{{one.product_id.price }}</h2>
                                                                <p class="description" >{{one.product_id.Description}}</p>
                                                                <p class='product_id'style="display:none">{{one.product_id.Id}}</p>
                                                                <p class='cart_id'style="display:none;">{{one.cart_id}}</p>
                                                                <button class="btn btn-sm btn-outline-dark" onmouseover="addcontent(this,'remove from Cart')" onmouseout="removecontent(this,'Cart')" onclick="deletecart(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                                <button class="btn btn-sm btn-outline-dark"  onmouseover="addcontent(this,'Sell')" onmouseout="removecontent(this,'Buy')"><i class="fas fa-money-check-alt fa-2x "></i></button>
                                                                <a style="display: block; margin-top: 15px;" href="User/{{one.request_id.id}}/">Requested-User ->{{ one.request_id.first_name }}</a>
                                                                </div>         
                                                        </div>
                                                {% if two %}
                                                        <div  class="col-sm-6 columns" >
                                                                <div class="card-content"  ondblclick="detailvalue(this)" >
                                                                        <h4 id="righttext" ><span style="margin-left: 5px;">{{ two.product_id.Productname}}</span></h4>
                                                                        <img class="rounded" src="{{ two.product_id.product_mage.url }}" alt="Oh no image!">
                                                                        <h2 class="price">Rs.{{two.product_id.price}}</h2>
                                                                        <p class="description" >{{two.product_id.Description}}</p>
                                                                        <p class='product_id'style="display:none;">{{two.product_id.Id}}</p>
                                                                        <p class='cart_id'style="display:none;">{{two.cart_id}}</p>
                                                                        <button class="btn btn-sm btn-outline-dark" onmouseover="addcontent(this,'remove from Cart')" onmouseout="removecontent(this,'Cart')" onclick="deletecart(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                                        <button class="btn btn-sm btn-outline-dark"  onmouseover="addcontent(this,'Sell')" onmouseout="removecontent(this,'Buy')"><i class="fas fa-money-check-alt fa-2x "></i></button>
                                                                        <br>
                                                                        <a  style="display: block; margin-top: 15px;" href="User/{{two.request_id.id}}/">Requested-User ->{{ two.request_id.first_name }}</a>
                                                                </div>
                                                        </div>
                                                {% endif %}
                                        </div>
                                        {% empty %}
                                        <div class="conatiner" style="width:70%;margin: auto;">
                                                <img src="{% static 'empty.png'%}" alt="No product match">
                                        </div>
                                        {% endfor %}

                            
                            {%elif option == 'Posted-Product' %} 

                                        {%for one,two in objects %}
                                        <div class="row" style="margin-left:5%;">
                                                    <div  class="col-sm-6 columns" >
                                                            <div class="card-content"  ondblclick="detailvalue(this)" >
                                                                    <h4 id="lefttext" ><span style="margin-left: 5px;">{{one.Productname}}</span></h4>
                                                                    <img class="rounded" src="{{ one.product_mage.url }}" alt="Oh no image!" >
                                                                    <h2 class="price" >Rs.{{one.price }}</h2>
                                                                    <p class="description">{{one.Description}}</p>
                                                                    <p class='product_id'style="display:none">{{one.Id}}</p>
                                                                    <button class="btn btn-sm btn-outline-dark" onmouseover="addcontent(this,'Remove-Product')" onmouseout="removecontent(this,'Product')" onclick="Removeproduct(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                             </div>
                                                    </div>
                                            {% if two %}
                                                    <div  class="col-sm-6 columns" >
                                                        <div class="card-content"  ondblclick="detailvalue(this)" >
                                                            <h4 id="righttext" ><span style="margin-left: 5px;">{{ two.Productname}}</span></h4>
                                                            <img class="rounded" src="{{ two.product_mage.url }}" alt="Oh no image!"  >
                                                            <h2 class="price">Rs.{{two.price}}</h2>
                                                            <p class="description"  >{{two.Description}}</p>
                                                            <p class='product_id'style="display:none;">{{two.Id}}</p>
                                                            <button class="btn btn-sm btn-outline-dark" onmouseover="addcontent(this,'Remove-Product')" onmouseout="removecontent(this,'Product')" onclick="Removeproduct(this)"><i class="fas fa-shopping-cart fa-2x "></i></button>
                                                        </div>
                                                    </div>
                                                                        
                                            {% endif %}</div>
                                            {% empty %}
                                            <div class="conatiner" style="width:70%;margin: auto;">
                                                    <img src="{% static 'empty.png'%}" alt="No product match">
                                            </div>
                                            {% endfor %}

                            {% else %}                                   
                            <strong>
                                            <form method="post" id="postform" enctype="multipart/form-data" > 
                                                    <h3 style="text-align: left;padding-bottom: 2%;"><strong>Post Product Here</strong></h3>
                                                        {% csrf_token %}
                                                        {{ form|crispy }}
                                                    <button type="submit" class="btn btn-success">Post</button>
                                            </form>
                                    </strong>
                                    <script>
                                    $("#postform").ready(function(){
                                            $(".custom-file-label").remove()
                                            $("input[name=payment_qr]").removeClass("form-control custom-file-input")
                                            $("input[name=product_mage]").removeClass("form-control custom-file-input")
                                            $("input[name=Upload_date]").datepicker({
                                            changeMonth: true,
                                            changeYear: true
                                        });
                                    })
                                    </script>

                            {% endif %}
                        </div>
                    </div>
                <div class="pagination mt-4" style="color: black; width: 52%; margin: auto;text-align: center;">
                        <span class="step-links">
                            {% if pagenumber.has_previous %}
                                <a class="btn btn-primary btn-sm" href="?page=1" role="button" style="width:100px ;height: 30px;">&laquo; first</a>
                                <a class="btn btn-primary btn-sm" href="?page={{ pagenumber.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q}}{% endif %}" role="button" style="width:100px ;height: 30px;">previous</a>
                            {% endif %}
                    
                            <span class="current btn btn-warning btn-sm" style="width:150px;height: 30px;">
                                Page {{ pagenumber.number }} of {{ pagenumber.paginator.num_pages }}.
                            </span>
                    
                            {% if pagenumber.has_next %}
                                <a class="btn btn-primary btn-sm" href="?page={{ pagenumber.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q}}{% endif %}" role="button" style="width:100px ;height: 30px;">next</a>
                                <a class="btn btn-primary btn-sm" href="?page={{ pagenumber.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q}}{% endif %}" role="button" style="width:100px ;height: 30px;">last &raquo;</a>
                            {% endif %}
                        </span>
                    </div>
            </div>
        </div>

<script>
        $(document).ready(function(){
                $(".columns").fadeIn(1000);
                if (localStorage.getItem('ptr')!=null){
                        $("#"+localStorage.getItem('ptr')).css('background-color','rgb(127, 178, 212)') 
                }
        }
       )

        function detailvalue(ptr) {
                var x = $(ptr).find('.product_id').text()
                window.location="{% url 'homepage' %}"+x+"/"
        }
                        function conformation() {
                            if(confirm("Are you sure you want to logout?")){
                              window.location="{% url 'logout' %}"
                          }
                        }

                        function addcontent(ptr,ch) {
                                $(ptr).empty()
                                if(ch =='Buy'){
                                        
                                        $(ptr).append("<strong class='ml-2'>Buy!</strong>")
                                }else{
                                        $(ptr).append("<b>"+ch+"</b>")
                                } 
                        }
                        function removecontent(ptr,ch) {
                                $(ptr).empty()
                                if(ch =='Buy'){ 
                                        $(ptr).append("<i class='fas fa-money-check-alt fa-2x '></i>")
                                }else{
                                        $(ptr).append("<i class='fas fa-shopping-cart fa-2x '></i>")

                                }
                        }

                        function deletecart(ptr){
                                var cid = $(ptr).parent('.card-content').find('.cart_id').text()
                                var pid = $(ptr).parent('.card-content').find('.product_id').text()
                                if(confirm("Are you Sure you want to remove product from cart")){
                                $.ajax({
                                        url: "{% url 'cart_remove' %}",
                                        type: "POST",
                                        headers : {"X-CSRFToken":'{{ csrf_token }}'},
                                        data : {"cart_id":cid,"productid":pid},
                                        success : function name(params){
                                                window.location="{% url 'cart_view' %}"
                                        },
                                        error : function name(params) {
                                                alert("System error try after some time");
                                        }
                                })
                            }
                        }

                        function options(ptr){
                                $("#catogorylist").find('li').css('background-color','white')
                                $("#catogorylist").find('li').css('color','black')
                                $(ptr).css('background-color','rgb(127, 178, 212)')
                                localStorage.setItem("ptr",$(ptr).attr('id'))
                                $.ajax({
                                        url: "{% url 'cart_options' %}",
                                        type: "POST",
                                        headers : {"X-CSRFToken":'{{ csrf_token }}'},
                                        data : {"cart_option":$(ptr).text()},
                                        success : function name(params){
                                                window.location="{% url 'cart_view' %}"
                                                
                                        },
                                        error : function name(params) {
                                                alert("System error try after some time");
                                        }
                                })      
                        }

                        function Removeproduct(ptr){
                            if(confirm("Are you Sure you want to delete product")){
                                $.ajax({
                                        url: "{% url 'remove_product' %}",
                                        type: "POST",
                                        headers : {"X-CSRFToken":'{{ csrf_token }}'},
                                        data : {"product_id":$(ptr).parent('.card-content').find('.product_id').text()},
                                        success : function name(params){
                                                window.location="{% url 'cart_view' %}"                  
                                        },
                                        error : function name(params) {
                                                alert("System error try after some time");
                                        }
                                })   }  
                        }
</script>
{% endblock %}